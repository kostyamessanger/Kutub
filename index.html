<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Kutub</title>

<style>
:root {
  --bg: #0f0f0f;
  --card: #1c1c1c;
  --accent: #ff0033;
  --text: #ffffff;
  --muted: #9a9a9a;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: Inter, Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
}

header {
  padding: 16px 20px;
  background: #151515;
  font-size: 22px;
  font-weight: 600;
}

main {
  padding: 20px;
  max-width: 900px;
  margin: auto;
}

.upload {
  background: var(--card);
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 20px;
}

.upload input {
  width: 100%;
  margin-bottom: 8px;
  padding: 8px;
  background: #111;
  border: 1px solid #333;
  color: white;
  border-radius: 6px;
}

.upload button {
  background: var(--accent);
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
}

.video {
  background: var(--card);
  border-radius: 10px;
  padding: 12px;
  margin-bottom: 12px;
  transition: transform .15s ease;
}

.video:hover {
  transform: scale(1.01);
}

.video-title {
  cursor: pointer;
  font-weight: 600;
}

.actions {
  margin-top: 8px;
}

.actions button {
  background: none;
  border: none;
  color: var(--accent);
  cursor: pointer;
  margin-right: 10px;
}

#modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.7);
  display: none;
  align-items: center;
  justify-content: center;
}

#modalContent {
  background: #000;
  padding: 15px;
  border-radius: 10px;
  max-width: 800px;
  width: 90%;
}

#modal video {
  width: 100%;
}
</style>
</head>

<body>

<header>Kutub</header>

<main>

<div class="upload">
  <input id="title" placeholder="Название видео">
  <input id="file" type="file" accept="video/*">
  <button onclick="upload()">Опубликовать</button>
</div>

<div id="videos"></div>

</main>

<div id="modal" onclick="closeModal()">
  <div id="modalContent" onclick="event.stopPropagation()">
    <video id="player" controls></video>
  </div>
</div>

<script>
const API = "https://kutub-server.k90183621.workers.dev";
const videosEl = document.getElementById("videos");

function loadVideos() {
  fetch(API + "/videos")
    .then(r => r.json())
    .then(d => {
      videosEl.innerHTML = "";
      d.videos.forEach(v => {
        const el = document.createElement("div");
        el.className = "video";
        el.innerHTML = `
          <div class="video-title" onclick="watch('${v.id}')">${v.title}</div>
          <div class="actions">
            ❤️ <span id="l-${v.id}">${v.likes}</span>
            <button onclick="like('${v.id}')">Лайк</button>
            <button onclick="removeVideo('${v.id}')">Удалить</button>
          </div>
        `;
        videosEl.appendChild(el);
      });
    });
}

function watch(id) {
  document.getElementById("player").src = API + "/video/" + id;
  document.getElementById("modal").style.display = "flex";
}

function closeModal() {
  document.getElementById("player").pause();
  document.getElementById("modal").style.display = "none";
}

function like(id) {
  fetch(API + "/like", {
    method: "POST",
    headers: {"content-type":"application/json"},
    body: JSON.stringify({ videoId: id })
  });
  document.getElementById("l-" + id).innerText++;
}

function removeVideo(id) {
  fetch(API + "/delete", {
    method: "POST",
    headers: {"content-type":"application/json"},
    body: JSON.stringify({ videoId: id })
  }).then(loadVideos);
}

function upload() {
  const file = fileInput.files[0];
  const title = document.getElementById("title").value;
  if (!file || !title) return;

  const fd = new FormData();
  fd.append("video", file);
  fd.append("title", title);

  fetch(API + "/upload", { method: "POST", body: fd })
    .then(loadVideos);
}

loadVideos();
</script>

</body>
</html>
