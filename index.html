<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Kutub ‚Äî –≤–∏–¥–µ–æ—Ö–æ—Å—Ç–∏–Ω–≥</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #0f0f0f;
    color: white;
    padding: 20px;
  }
  h1 {
    margin-top: 0;
  }
  .video {
    background: #1f1f1f;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 6px;
  }
  button {
    background: #ff0033;
    color: white;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    border-radius: 4px;
  }
  input {
    margin-bottom: 6px;
  }
  #status {
    color: #aaa;
    font-size: 14px;
  }
</style>
</head>

<body>

<h1>üé¨ Kutub</h1>
<div id="status">–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º Kutub‚Ä¶</div>

<hr>

<h3>üì§ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ</h3>
<input id="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ"><br>
<input id="file" type="file" accept="video/*"><br>
<button onclick="upload()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>

<hr>

<h3>üì∫ –í–∏–¥–µ–æ –Ω–∞ Kutub</h3>
<div id="videos">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ‚Ä¶</div>

<script>
  // üî• –ù–ê–® –°–ï–†–í–ï–† KUTUB
  const API = "https://kutub-server.k90183621.workers.dev";

  const statusEl = document.getElementById("status");
  const videosEl = document.getElementById("videos");

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
  fetch(API + "/")
    .then(r => r.json())
    .then(() => {
      statusEl.innerText = "–°–µ—Ä–≤–µ—Ä Kutub: –æ–Ω–ª–∞–π–Ω ‚úÖ";
    })
    .catch(() => {
      statusEl.innerText = "–°–µ—Ä–≤–µ—Ä Kutub –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚ùå";
    });

  // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ
  function loadVideos() {
    fetch(API + "/videos")
      .then(r => r.json())
      .then(data => {
        videosEl.innerHTML = "";
        data.videos.forEach(v => {
          const div = document.createElement("div");
          div.className = "video";
          div.innerHTML = `
            <b>${v.title}</b><br>
            ‚ù§Ô∏è <span id="l-${v.id}">${v.likes}</span>
            <button onclick="like('${v.id}')">–õ–∞–π–∫</button>
          `;
          videosEl.appendChild(div);
        });
      })
      .catch(() => {
        videosEl.innerText = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ";
      });
  }

  // –õ–∞–π–∫
  function like(id) {
    fetch(API + "/like", {
      method: "POST",
      headers: { "content-type": "application/json" },
      body: JSON.stringify({ videoId: id })
    });
    document.getElementById("l-" + id).innerText++;
  }

  // –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤–∏–¥–µ–æ
  function upload() {
    const file = document.getElementById("file").files[0];
    const title = document.getElementById("title").value;

    if (!file || !title) {
      alert("–í—ã–±–µ—Ä–∏ –≤–∏–¥–µ–æ –∏ –Ω–∞–ø–∏—à–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ");
      return;
    }

    const fd = new FormData();
    fd.append("video", file);
    fd.append("title", title);

    fetch(API + "/upload", {
      method: "POST",
      body: fd
    }).then(() => {
      loadVideos();
      document.getElementById("title").value = "";
      document.getElementById("file").value = "";
    });
  }

  loadVideos();
</script>

</body>
</html>
